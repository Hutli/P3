\section{Algorithm}
\label{sec:algorithm}

The music at a bar should never stop playing as described in \cref{musthave}. To handle that the music does not stop playing, when there is not voted on any song. To handle this an algorithm was designed to chose a song similarly to the songs that was previously played. In \cref{sub:MusicFlow} it's described that the music may not soundly change genre. This algorithm should prevent the music from from making these soundly music changes, by looking at the 9 last played songs.


\makeatletter
% start with some helper code
% This is the vertical rule that is inserted
\newcommand*{\algrule}[1][\algorithmicindent]{\makebox[#1][l]{\hspace*{.5em}\vrule height .75\baselineskip depth .25\baselineskip}}%

\newcount\ALG@printindent@tempcnta
\def\ALG@printindent{%
    \ifnum \theALG@nested>0% is there anything to print
        \ifx\ALG@text\ALG@x@notext% is this an end group without any text?
            % do nothing
            \addvspace{-1pt}% FUDGE for cases where no text is shown, to make the rules line up
        \else
            \unskip
            % draw a rule for each indent level
            \ALG@printindent@tempcnta=1
            \loop
                \algrule[\csname ALG@ind@\the\ALG@printindent@tempcnta\endcsname]%
                \advance \ALG@printindent@tempcnta 1
            \ifnum \ALG@printindent@tempcnta<\numexpr\theALG@nested+1\relax% can't do <=, so add one to RHS and use < instead
            \repeat
        \fi
    \fi
    }%
% the following line injects our new indent handling code in place of the default spacing
\patchcmd{\ALG@doentity}{\noindent\hskip\ALG@tlm}{\ALG@printindent}{}{\errmessage{failed to patch}}
\makeatother
% end vertical rule patch for algorithmicx

\renewcommand{\algorithmicforall}{\textbf{for each}}

\begin{algorithm}[hbtp]
\caption{Algorithm for finding the next track to be played.}
\begin{algorithmic}[1]
	\Function{nextTrack}{$trackHistory$} \Comment{$trackHistory$ is a list of previously played tracks.}
		\State{$k = 9$}
		\State{$l = empty$ $list$}
		\If{$trackHistory.length < 9$}
			\State{$k = trackHistory.length$}
		\EndIf{}
		\For{$i = 0$ \textbf{to} $k$}
			\ForAll{$artist$ \textbf{in} $trackHistory[i].Artists$}
				\ForAll{$relatedArtist$ \textbf{in} $artist.relatedArtists$}
					\If{$l.contains(relatedArtist)$}
						\State{$relatedArtist.count += 1$}
					\Else{}
						\State{$l.add(relatedArtist)$}
						\State{$relatedArtist.count = 1$}
					\EndIf{}
				\EndFor{}
			\EndFor{}
		\EndFor{}
		\State{$x = null$}
		\ForAll{$artist$ \textbf{in} $l$}
			\If{$x = null$ || $artist.count > x.count$}
				\State{$x = artist$}
			\EndIf{}
		\EndFor{}
		\ForAll{$track$ \textbf{in} $x.top$}
			\If{$!trackHistory.contains(track)$}
			\State{}\Return{$track$}			
			\EndIf{}
		\EndFor{}
	\EndFunction{}
\end{algorithmic}
\end{algorithm}





